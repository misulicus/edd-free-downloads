function edd_free_downloads_append_query_string(d,e,a){var o=new RegExp("([?&])"+e+"=.*?(&|$)","i");if(void 0!==d)var r=-1!==d.indexOf("?")?"&":"?";return void 0!==d&&d.match(o)?d.replace(o,"$1"+e+"="+a+"$2"):d+r+e+"="+a}jQuery(document.body).ready(function(d){"use strict";var e=d(document.body);function a(){d(".edd-free-downloads-modal-wrapper .edd-loading").hide(),d(".edd-free-downloads-modal-wrapper").fadeOut(250),d("#edd-free-downloads-modal").hide().html(""),d("body").removeClass("edd-frozen")}if(d('input[name="edd_options[price_id][]"]').length>0){var o,r,n,s,i,l;if(!(o=d(".edd_purchase_submit_wrapper").find("a.edd-add-to-cart").attr("class")))return;o=o.replace("edd-add-to-cart",""),l=isMobile.any?edd_free_downloads_vars.mobile_url:"#edd-free-download-modal","1"===edd_free_downloads_vars.has_ajax?(r='<div class="edd-free-downloads-variable-wrapper">',n='<a class="edd-free-downloads-variable edd-free-download '+o+'" href="'+l+'" data-download-id=""><span>',s="</span></a>",i="</div>"):(r="",n='<input type="submit" class="edd-free-downloads-variable edd-free-download '+o+'" name="edd_purchase_download" value="',s='" href="'+l+'" data-download-id="" />',i=""),d(".edd_purchase_submit_wrapper").each(function(e){if("yes"===d(".edd_purchase_submit_wrapper").eq(e).find(".edd-add-to-cart").data("variable-price")){var a=d(this).closest("form").attr("id").replace("edd_purchase_","");"true"===edd_free_downloads_vars.bypass_logged_in?d(this).after(r+'<a href="#" class="edd-free-downloads-direct-download-link '+o+'" data-download-id="'+a+'">'+edd_free_downloads_vars.download_label+"</a>"+i):d(this).after(r+n+edd_free_downloads_vars.download_label+s+i),d(this).parent().find(".edd-free-downloads-variable").attr("data-download-id",a),"0.00"===d(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")?(d(this).css("display","none"),d(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block")):"0.00"===d(this).prev().find('input[name="edd_options[price_id][]"]:checked').attr("data-price")?(d(this).css("display","none"),d(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","block")):(d(this).css("display","block"),d(this).parent().find(".edd-free-downloads-variable-wrapper").css("display","none"))}}),e.on("change",'input[name="edd_options[price_id][]"]',function(){var e=0,a=0,o=[],r=d(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href");(r=edd_free_downloads_append_query_string(r,"download_id",d(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").find(".edd-add-to-cart").attr("data-download-id")),d(this).closest("ul").find('input[name="edd_options[price_id][]"]').each(function(){d(this).is(":checked")&&(e+=parseFloat(d(this).attr("data-price")),a+=1,o.push(parseInt(d(this).val())))}),0!==a)?0===e?(r=edd_free_downloads_append_query_string(r,"price_ids",JSON.stringify(o)),d(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",r),d(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","none"),d(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","block")):(d(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","block"),d(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","none"),d(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",r)):(d(this).closest(".edd_download_purchase_form").find(".edd_purchase_submit_wrapper").css("display","block"),d(this).closest(".edd_download_purchase_form").find(".edd-free-downloads-variable-wrapper").css("display","none"),d(this).closest(".edd_download_purchase_form").find("a.edd-free-downloads-variable").attr("href",r))}),d(document.body).on("click",".edd-free-downloads-variable",function(d){d.preventDefault()})}function t(){var o=d("#edd_free_download_form");e.addClass("edd-frozen"),o.find("input").first().focus(),o.on("click",".edd-free-download-submit",function(e){var r,n,s,i,l=0,t=o.find('input[name="edd_free_download_email"]');if(""===t.val()?(d(".edd-free-download-errors").show(),d("#edd-free-download-error-email-required").css("display","block"),l++,e.preventDefault()):(d("#edd-free-download-error-email-required").css("display","none"),/^((([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([A-Za-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([A-Za-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([A-Za-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/.test(t.val())?d("#edd-free-download-error-email-invalid").css("display","none"):(d(".edd-free-download-errors").show(),d("#edd-free-download-error-email-invalid").css("display","block"),l++,e.preventDefault())),"true"===edd_free_downloads_vars.require_name){var f=d('#edd_free_download_form input[name="edd_free_download_fname"]'),c=d('#edd_free_download_form input[name="edd_free_download_lname"]');""===f.val()?(d(".edd-free-download-errors").show(),d("#edd-free-download-error-fname-required").css("display","block"),l++,e.preventDefault()):d("#edd-free-download-error-fname-required").css("display","none"),""===c.val()?(d(".edd-free-download-errors").show(),d("#edd-free-download-error-lname-required").css("display","block"),l++,e.preventDefault()):d("#edd-free-download-error-lname-required").css("display","none")}"true"===edd_free_downloads_vars.user_registration&&(r=d('input[name="edd_free_download_username"]'),n=d('input[name="edd_free_download_pass"]'),s=d('input[name="edd_free_download_pass2"]'),i="1"===edd_free_downloads_vars.guest_checkout_disabled,""===r.val()&&i&&(d("#edd-free-download-error-username-required").css("display","block"),l++),""!==n.val()||!i&&""===r.val()||(d("#edd-free-download-error-password-required").css("display","block"),l++),""!==s.val()||!i&&""===r.val()||(d("#edd-free-download-error-password2-required").css("display","block"),l++),""!==n.val()&&""!==s.val()&&(n.val()===s.val()||!i&&""===r.val()?d("#edd-free-download-error-password-unmatch").css("display","none"):(d("#edd-free-download-error-password-unmatch").css("display","block"),l++)));if(d("#edd-free-download-privacy-agreement").length&&!d("#edd-free-download-privacy-agreement").is(":checked")?(l++,d("#edd-free-download-error-privacy-policy").css("display","block")):d("#edd-free-download-error-privacy-policy").css("display","none"),0===l)if(d(".edd-free-download-submit span").html(edd_free_downloads_vars.download_loading),d(".edd-free-download-submit span").append('<i class="edd-icon-spinner edd-icon-spin"></i>'),d(".edd-free-download-submit").attr("disabled","disabled"),"1"===edd_free_downloads_vars.email_verification){e.preventDefault();var _=d("#edd_free_download_form").serialize();d.ajax({url:edd_free_downloads_vars.ajaxurl,type:"POST",data:_,success:function(e){d(".edd-free-downloads-verification-message").html(e.message).fadeIn(),d(".edd-free-downloads-verification-message-wrapper").removeClass("edd-alert-info"),e.success?(d(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-success",250),d(".edd-free-download-submit").hide(),d(".edd-free-download-cancel").hide()):d(".edd-free-downloads-verification-message-wrapper").addClass("edd-alert-error",250)}})}else d("#edd_free_download_form").submit(),"default"!=edd_free_downloads_vars.on_complete_handler&&"redirect"!=edd_free_downloads_vars.on_complete_handler&&setTimeout(function(){a()},edd_free_downloads_vars.on_complete_delay);else d(".edd-free-download-errors").css("display","block"),d(".edd-free-download-submit").removeAttr("disabled"),e.preventDefault()})}function f(e){var o=[],r=e.parent().parent().find('input[name="edd_free_download_id"]').val();r||(r=e.parent().parent().find(".edd-free-download").data("download-id")),r||(r=e.data("download-id")),e.parent().parent().find('input[name="edd_free_download_price_id[]"]').length>0?e.parent().parent().find('input[name="edd_free_download_price_id[]"]').each(function(){o.push(d(this).val().toString())}):e.parent().parent().find('input[name="edd_options[price_id][]"]:checked').length>0&&e.parent().parent().find('input[name="edd_options[price_id][]"]:checked').each(function(){o.push(d(this).val().toString())});var n=window.location.href;-1!==n.indexOf("?")?n+="&":n+="?",isMobile.any||a(),window.location=n+"edd_action=free_downloads_process_download&download_id="+r+"&price_ids="+o}isMobile.any?(e.on("click","a.edd-free-download",function(e){e.preventDefault(),d('input[name="edd_free_download_email"]').focus(),d('input[name="edd_free_download_email"]').select(),window.location.href=d(this).attr("href")}),t(),e.on("click",".edd-free-download-cancel",function(){return parent.history.back(),!1})):e.on("click","a.edd-free-download",function(o){o.preventDefault();var r=d(this).data("download-id"),n=[],s=d(this).parent().parent().find('input[name="edd_options[price_id][]"]');s.length>0&&s.each(function(){d(this).parent().parent().find('input[name="edd_options[price_id][]"]').each(function(){(d(this).prop("checked")||"hidden"===d(this).attr("type"))&&n.push(d(this).val().toString())})}),d(".edd-free-downloads-modal-wrapper").fadeIn(250),d(".edd-free-downloads-modal-wrapper .edd-loading").show(),d.ajax({url:edd_free_downloads_vars.ajaxurl,type:"GET",data:{action:"edd_free_downloads_get_modal",download_id:r,price_ids:n,edd_is_mobile:edd_free_downloads_vars.edd_is_mobile,require_name:edd_free_downloads_vars.require_name,success_page:edd_free_downloads_vars.success_page},success:function(o){d("#edd-free-downloads-modal").prepend(o).fadeIn(250),d(".edd-free-downloads-modal-wrapper .edd-loading").hide(),d(".edd-free-downloads-modal-wrapper .edd-free-downloads-modal-close").on("click",function(){a()}),d("#edd-free-downloads-modal").on("click","a.edd-free-downloads-direct-download-link",function(e){e.preventDefault(),f(d(this))}),d("#edd-free-downloads-modal").on("click",function(d){d.stopPropagation()}),d("#edd-free-downloads-modal").parent(".edd-free-downloads-modal-wrapper").on("click",function(){a()}),e.on("keypress",".edd-free-download-field",function(e){if(13===e.which)return d(".edd-free-download-submit").click(),!1}),e.on("keypress",".edd-free-downloads-modal-close",function(e){if(13===e.which||32===e.which)return d(".edd-free-downloads-modal-close").click(),!1}),e.on("keyup",function(d){27===d.keyCode&&a()}),t()}})}),e.on("click","a.edd-free-downloads-direct-download-link",function(e){e.preventDefault(),f(d(this))})});